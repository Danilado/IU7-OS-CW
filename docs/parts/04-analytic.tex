\section{Аналитический раздел}

\subsection{Постановка задачи}

В соответствии с заданием на курсовую работу, необходимо разработать загружаемый модуль ядра Linux, реализующий виртуальное устройство мыши, принимающий команды от мобильного приложения на смартфоне по каналу Bluetooth и преобразующий эти команды в события подсистемы ввода.

Для выполнения этой задачи требуется:
\begin{enumerate}
	\item проанализировать предметную область;
	\item разработать алгоритмы и структуру загружаемого модуля ядра, обрабатывающего информацию, полученную со смартфона и преобразующего её в события подсистемы ввода;
	\item реализовать загружаемый модуль ядра, выполняющий поставленную задачу;
	\item протестировать работу реализованного загружаемого модуля ядра.
\end{enumerate}

\input{parts/analytic/01-mapping.tex}

\input{parts/analytic/02-transfer.tex}

\input{parts/analytic/03-movement.tex}

\input{parts/analytic/04-entrypoints.tex}

\subsection*{Выводы}

Проанализированы способы сопоставления данных сенсорного экрана с перемещением курсора. 
Было рассмотрено использование абсолютных координат и относительных смещений \texttt{dx/dy}. 
Сравнительный анализ способов сопоставления данных сенсорного экрана с перемещением курсора приведён в таблице~\ref{tab:cursor-mapping-comparison}.

\begin{longtable}{|p{0.26\linewidth}|p{0.33\linewidth}|p{0.33\linewidth}|}
\caption{Сравнительный анализ способов сопоставления данных сенсорного экрана с перемещением курсора}\label{tab:cursor-mapping-comparison}\\
\hline
Критерий & Абсолютные координаты & Относительные смещения \\
\hline
Зависимость от геометрии экранов & Есть & Нет \\
\hline
Объём передаваемых данных & Полные координаты & Только смещения \texttt{dx/dy} \\
\hline
Устойчивость к многомониторным конфигурациям & Требуется нормализация и учёт топологии & Не требует специальных настроек \\
\hline
\end{longtable}

Был выбран способ передачи относительных смещений, так как этот подход независим от геометрии экранов, минимизирует объём данных и достаточен для перемещения курсора мыши.

\

Проанализированы способы удалённого взаимодействия устройств на основе подсистемы Bluetooth.
Было рассмотрено взаимодействие по протоколу L2CAP и использование RFCOMM в пространстве ядра. 
RFCOMM обеспечивает потоковый канал, прямо поддерживается Android API и не требует ручной сборки пакетов. 
Использование протокола L2CAP требует собственной обработки параметров канала и не имеет стандартной поддержки на стороне Android-приложения. 
Был выбран RFCOMM-сокет в пространстве ядра, так как он совместим с Android API и обеспечивает надёжный обмен без усложнения модуля.

\

Проанализированы способы генерации событий ввода. 
Была рассмотрена регистрация собственного \texttt{input\_dev} и вмешательство в существующий стек ввода.
Для \texttt{input\_dev} доступны прямые вызовы \texttt{input\_report\_*}, обеспечивающие полный контроль над формируемыми событиями в пределах модуля ядра.
Вмешательство в существующий стек зависит от внешних обработчиков и их форматов, что накладывает ограничения и увеличивает риск несовместимостей. 
Был выбран вариант с регистрацией собственного виртуального устройства ввода. 
Прямое формирование \texttt{EV\_REL}/\texttt{EV\_KEY} в модуле обеспечивает требуемый функционал без вмешательства в существующий стек ввода. 
Виртуальное устройство определяется системой как компьютерная мышь, что позволяет производить настраивать устройство в том числе и с помощью настроек графической оболочки системы.
